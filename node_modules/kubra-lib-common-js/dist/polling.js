'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.polling = polling;

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function polling(callback, successCondition, time) {
  return new _bluebird2.default(function (resolve, reject) {
    var result = null;
    var attempts = 0;
    var maxAttempts = 5;
    var intervalId = setInterval(function () {
      attempts += 1;
      var execError = null;
      try {
        result = callback();
      } catch (exception) {
        execError = exception;
      }
      if (successCondition(result) || attempts === maxAttempts) {
        clearInterval(intervalId);
        if (successCondition(result)) {
          resolve(result);
        } else {
          var error = new Error('Failed to find success in polling.');
          error.data = result;
          if (execError) {
            error.executionError = execError;
          }
          reject(error);
        }
      }
    }, time);
  });
}

exports.default = polling;